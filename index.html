<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi Tricot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 25px;
            text-align: center;
            font-size: 28px;
        }
        
        h2 {
            color: #764ba2;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 8px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .section {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .section-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .step {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .step input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            cursor: pointer;
        }
        
        .step-info {
            flex: 1;
        }
        
        .step-name {
            font-weight: 600;
            color: #333;
        }
        
        .step-details {
            font-size: 13px;
            color: #666;
            margin-top: 3px;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        .result {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #4caf50;
        }
        
        .result h3 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .conversion-item {
            padding: 8px 0;
            border-bottom: 1px solid #c8e6c9;
        }
        
        .conversion-item:last-child {
            border-bottom: none;
        }
        
        .add-section {
            margin-top: 15px;
        }
        
        .delete-btn {
            background: #ff5252;
            padding: 6px 12px;
            font-size: 14px;
            margin-top: 5px;
            width: auto;
        }
        
        .edit-btn {
            background: #ffa726;
            padding: 6px 12px;
            font-size: 14px;
            margin-top: 5px;
            width: auto;
            margin-right: 8px;
        }
        
        .step-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            margin-left: 35px;
        }
        
        .edit-form {
            margin: 10px 0 10px 35px;
            background: #fff3e0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #ffa726;
        }
        
        .edit-form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .edit-form-row input {
            flex: 1;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .edit-form-buttons {
            display: flex;
            gap: 8px;
        }
        
        .edit-form-buttons button {
            padding: 8px 16px;
            font-size: 14px;
            margin-top: 0;
        }
        
        .save-btn {
            background: #4caf50;
        }
        
        .cancel-btn {
            background: #9e9e9e;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß∂ Mon Suivi Tricot</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('suivi')">Suivi</button>
            <button class="tab" onclick="switchTab('calcul')">Calcul</button>
            <button class="tab" onclick="switchTab('augmentation')">Aug./Dim.</button>
        </div>
        
        <!-- ONGLET SUIVI -->
        <div id="suivi" class="tab-content active">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            
            <div id="projectSections"></div>
            
            <div class="add-section">
                <h2>Ajouter une partie</h2>
                <div class="form-group">
                    <label>Nom de la partie (ex: Devant)</label>
                    <input type="text" id="newSectionName">
                </div>
                <button onclick="addSection()">‚ûï Ajouter une partie</button>
            </div>
        </div>
        
        <!-- ONGLET CALCUL -->
        <div id="calcul" class="tab-content">
            <h2>üìè √âchantillon du mod√®le</h2>
            <div class="form-group">
                <label>Mailles du mod√®le (pour 10x10 cm)</label>
                <input type="number" id="modelMailles" value="15">
            </div>
            <div class="form-group">
                <label>Rangs du mod√®le (pour 10x10 cm)</label>
                <input type="number" id="modelRangs" value="18">
            </div>
            
            <h2>üßµ Votre √©chantillon r√©el</h2>
            <div class="form-group">
                <label>Vos mailles (pour 10x10 cm)</label>
                <input type="number" id="realMailles" value="19">
            </div>
            <div class="form-group">
                <label>Vos rangs (pour 10x10 cm)</label>
                <input type="number" id="realRangs" value="23">
            </div>
            
            <h2>üî¢ Valeurs √† convertir</h2>
            <div class="form-group">
                <label>Nombre de mailles du mod√®le</label>
                <input type="number" id="maillesAConvertir" value="100">
            </div>
            <div class="form-group">
                <label>Nombre de rangs du mod√®le</label>
                <input type="number" id="rangsAConvertir" value="120">
            </div>
            
            <button onclick="calculerConversion()">üßÆ Calculer la conversion</button>
            
            <div id="resultatConversion"></div>
            
            <h2>üìê Convertisseur cm ‚Üî mailles/rangs</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                Utilisez les m√™mes valeurs d'√©chantillon ci-dessus pour ces conversions
            </p>
            
            <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <h3 style="color: #667eea; margin-bottom: 10px; font-size: 16px;">CM ‚Üí Mailles/Rangs</h3>
                <div class="form-group">
                    <label>Largeur en cm</label>
                    <input type="number" id="largeurCm" value="30" step="0.5">
                </div>
                <div class="form-group">
                    <label>Hauteur en cm</label>
                    <input type="number" id="hauteurCm" value="40" step="0.5">
                </div>
                <button onclick="calculerCmVersMailles()">‚û°Ô∏è Convertir en mailles/rangs</button>
                <div id="resultatCmVersMailles"></div>
            </div>
            
            <div style="background: #f5f5f5; padding: 15px; border-radius: 10px;">
                <h3 style="color: #667eea; margin-bottom: 10px; font-size: 16px;">Mailles/Rangs ‚Üí CM</h3>
                <div class="form-group">
                    <label>Nombre de mailles</label>
                    <input type="number" id="maillesVersCm" value="60">
                </div>
                <div class="form-group">
                    <label>Nombre de rangs</label>
                    <input type="number" id="rangsVersCm" value="80">
                </div>
                <button onclick="calculerMaillesVersCm()">‚û°Ô∏è Convertir en cm</button>
                <div id="resultatMaillesVersCm"></div>
            </div>
        </div>
        
        <!-- ONGLET AUGMENTATION/DIMINUTION -->
        <div id="augmentation" class="tab-content">
            <h2>üìê √âchantillon (m√™me valeurs que l'onglet Calcul)</h2>
            <div class="form-group">
                <label>Mailles du mod√®le (pour 10x10 cm)</label>
                <input type="number" id="augModelMailles" value="15">
            </div>
            <div class="form-group">
                <label>Rangs du mod√®le (pour 10x10 cm)</label>
                <input type="number" id="augModelRangs" value="18">
            </div>
            <div class="form-group">
                <label>Vos mailles r√©elles (pour 10x10 cm)</label>
                <input type="number" id="augRealMailles" value="19">
            </div>
            <div class="form-group">
                <label>Vos rangs r√©els (pour 10x10 cm)</label>
                <input type="number" id="augRealRangs" value="23">
            </div>
            
            <h2>üìè Instructions du mod√®le</h2>
            <div class="form-group">
                <label>Augmenter/diminuer d'1 maille tous les...</label>
                <input type="number" id="frequenceRangs" value="10" placeholder="ex: 10">
                <small style="color: #666; font-size: 12px;">nombre de rangs</small>
            </div>
            <div class="form-group">
                <label>Sur un total de...</label>
                <input type="number" id="totalRangs" value="60" placeholder="ex: 60">
                <small style="color: #666; font-size: 12px;">rangs au total</small>
            </div>
            
            <button onclick="calculerAugmentation()">üßÆ Calculer la conversion</button>
            
            <div id="resultatAugmentation"></div>
        </div>
    </div>

    <script>
        // Donn√©es du projet
        let project = {
            sections: [
                {
                    name: "Derri√®re",
                    steps: [
                        { name: "Corps", mailles: 80, rangs: 100, done: false, detailRangs: false },
                        { name: "√âpaule gauche", mailles: 30, rangs: 20, done: false, detailRangs: true, rangsDone: [] },
                        { name: "√âpaule droite", mailles: 30, rangs: 20, done: false, detailRangs: true, rangsDone: [] }
                    ]
                },
                {
                    name: "Devant",
                    steps: [
                        { name: "Corps", mailles: 80, rangs: 80, done: false, detailRangs: false },
                        { name: "Col", mailles: 40, rangs: 15, done: false, detailRangs: false },
                        { name: "√âpaule gauche", mailles: 30, rangs: 20, done: false, detailRangs: true, rangsDone: [] },
                        { name: "√âpaule droite", mailles: 30, rangs: 20, done: false, detailRangs: true, rangsDone: [] }
                    ]
                },
                {
                    name: "Manche 1",
                    steps: [
                        { name: "Corps de manche", mailles: 60, rangs: 80, done: false, detailRangs: true, rangsDone: [] }
                    ]
                },
                {
                    name: "Manche 2",
                    steps: [
                        { name: "Corps de manche", mailles: 60, rangs: 80, done: false, detailRangs: true, rangsDone: [] }
                    ]
                }
            ]
        };
        
        // Charger les donn√©es sauvegard√©es
        function loadProject() {
            const saved = localStorage.getItem('tricotProject');
            if (saved) {
                project = JSON.parse(saved);
            }
            renderProject();
        }
        
        // Sauvegarder les donn√©es
        function saveProject() {
            localStorage.setItem('tricotProject', JSON.stringify(project));
        }
        
        // Afficher le projet
        function renderProject() {
            const container = document.getElementById('projectSections');
            container.innerHTML = '';
            
            project.sections.forEach((section, sectionIndex) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section';
                
                let sectionHTML = `
                    <div class="section-header">${section.name}</div>
                `;
                
                section.steps.forEach((step, stepIndex) => {
                    // Initialiser rangsDone si n√©cessaire
                    if (step.detailRangs && !step.rangsDone) {
                        step.rangsDone = [];
                    }
                    
                    const rangsDoneCount = step.detailRangs ? step.rangsDone.length : 0;
                    const progressText = step.detailRangs ? ` (${rangsDoneCount}/${step.rangs} rangs)` : '';
                    
                    sectionHTML += `
                        <div class="step">
                            <input type="checkbox" ${step.done ? 'checked' : ''} 
                                   onchange="toggleStep(${sectionIndex}, ${stepIndex})"
                                   ${step.detailRangs ? 'disabled' : ''}>
                            <div class="step-info">
                                <div class="step-name">${step.name}${progressText}</div>
                                <div class="step-details">${step.mailles} mailles √ó ${step.rangs} rangs</div>
                            </div>
                        </div>
                    `;
                    
                    // Formulaire d'√©dition si en mode √©dition
                    if (step.editing) {
                        sectionHTML += `
                            <div class="edit-form">
                                <div class="edit-form-row">
                                    <input type="text" id="editName_${sectionIndex}_${stepIndex}" 
                                           value="${step.name}" placeholder="Nom de l'√©tape">
                                </div>
                                <div class="edit-form-row">
                                    <input type="number" id="editMailles_${sectionIndex}_${stepIndex}" 
                                           value="${step.mailles}" placeholder="Mailles de d√©part">
                                    <input type="number" id="editRangs_${sectionIndex}_${stepIndex}" 
                                           value="${step.rangs}" placeholder="Rangs totaux">
                                </div>
                                <div class="edit-form-row">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="checkbox" id="editDetail_${sectionIndex}_${stepIndex}" 
                                               ${step.detailRangs ? 'checked' : ''}>
                                        <span>Suivi rang par rang</span>
                                    </label>
                                </div>
                                <div class="edit-form-row">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                        <input type="checkbox" id="editAugmentation_${sectionIndex}_${stepIndex}" 
                                               ${step.hasAugmentation ? 'checked' : ''}
                                               onchange="toggleAugmentationFields(${sectionIndex}, ${stepIndex})">
                                        <span>üîº Augmentation de mailles</span>
                                    </label>
                                </div>
                                <div id="augFields_${sectionIndex}_${stepIndex}" style="display: ${step.hasAugmentation ? 'block' : 'none'};">
                                    <div class="edit-form-row">
                                        <input type="number" id="editAugMailles_${sectionIndex}_${stepIndex}" 
                                               value="${step.augmentationMailles || 2}" placeholder="Mailles √† ajouter">
                                        <input type="number" id="editAugFrequence_${sectionIndex}_${stepIndex}" 
                                               value="${step.augmentationFrequence || 8}" placeholder="Tous les X rangs">
                                    </div>
                                    <small style="color: #666; font-size: 12px; display: block; margin-top: -5px;">
                                        Exemple: +2 mailles tous les 8 rangs
                                    </small>
                                </div>
                                <div class="edit-form-buttons">
                                    <button class="save-btn" onclick="saveStep(${sectionIndex}, ${stepIndex})">üíæ Sauvegarder</button>
                                    <button class="cancel-btn" onclick="cancelEdit(${sectionIndex}, ${stepIndex})">‚ùå Annuler</button>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Boutons d'action
                    sectionHTML += `
                        <div class="step-actions">
                            <button class="edit-btn" onclick="editStep(${sectionIndex}, ${stepIndex})">‚úèÔ∏è Modifier</button>
                            <button class="delete-btn" onclick="deleteStep(${sectionIndex}, ${stepIndex})">üóëÔ∏è Supprimer</button>
                        </div>
                    `;
                    
                    // Afficher les rangs d√©taill√©s si activ√© et pas en mode √©dition
                    if (step.detailRangs && !step.editing) {
                        sectionHTML += '<div style="margin-left: 35px; margin-top: 10px;">';
                        
                        // Calculer les mailles pour chaque rang si augmentation
                        let maillesParRang = [];
                        if (step.hasAugmentation) {
                            let maillesActuelles = step.mailles;
                            for (let i = 1; i <= step.rangs; i++) {
                                maillesParRang[i] = maillesActuelles;
                                // Augmentation √† la fin du rang si c'est un rang d'augmentation
                                if (i > 0 && i % step.augmentationFrequence === 0) {
                                    maillesActuelles += step.augmentationMailles;
                                }
                            }
                        }
                        
                        sectionHTML += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 5px; margin-bottom: 10px;">';
                        
                        for (let i = 1; i <= step.rangs; i++) {
                            const isChecked = step.rangsDone.includes(i);
                            const checkboxStyle = isChecked ? 'background: #667eea; color: white;' : 'background: white;';
                            const isAugmentation = step.hasAugmentation && i % step.augmentationFrequence === 0;
                            const augStyle = isAugmentation ? 'border: 3px solid #4caf50; font-weight: bold;' : '';
                            
                            let label = `R${i}`;
                            if (step.hasAugmentation) {
                                const mailles = maillesParRang[i];
                                label = isAugmentation ? 
                                    `R${i}<br><small style="font-size: 10px;">${mailles}m +${step.augmentationMailles}</small>` :
                                    `R${i}<br><small style="font-size: 10px;">${mailles}m</small>`;
                            }
                            
                            sectionHTML += `
                                <label style="display: flex; align-items: center; justify-content: center; 
                                       padding: 8px 4px; border: 2px solid #e0e0e0; border-radius: 6px; 
                                       cursor: pointer; font-size: 12px; font-weight: 600; ${checkboxStyle} ${augStyle}
                                       line-height: 1.2; text-align: center;">
                                    <input type="checkbox" ${isChecked ? 'checked' : ''} 
                                           onchange="toggleRang(${sectionIndex}, ${stepIndex}, ${i})"
                                           style="display: none;">
                                    ${label}
                                </label>
                            `;
                        }
                        
                        sectionHTML += '</div>';
                        
                        // Afficher le r√©sum√© des augmentations
                        if (step.hasAugmentation) {
                            const nbAugmentations = Math.floor(step.rangs / step.augmentationFrequence);
                            const maillesFinales = step.mailles + (nbAugmentations * step.augmentationMailles);
                            sectionHTML += `
                                <div style="background: #e8f5e9; padding: 8px; border-radius: 6px; font-size: 13px; margin-top: 8px;">
                                    üìä <strong>${step.mailles}</strong> mailles ‚Üí <strong>${maillesFinales}</strong> mailles 
                                    (${nbAugmentations} augmentations de ${step.augmentationMailles} mailles)
                                </div>
                            `;
                        }
                        
                        sectionHTML += '</div>';
                    }
                });
                
                sectionHTML += `
                    <button onclick="addStepToSection(${sectionIndex})">‚ûï Ajouter une √©tape</button>
                    <button class="delete-btn" onclick="deleteSection(${sectionIndex})">üóëÔ∏è Supprimer cette partie</button>
                `;
                
                sectionDiv.innerHTML = sectionHTML;
                container.appendChild(sectionDiv);
            });
            
            updateProgress();
        }
        
        // Basculer une √©tape
        function toggleStep(sectionIndex, stepIndex) {
            project.sections[sectionIndex].steps[stepIndex].done = 
                !project.sections[sectionIndex].steps[stepIndex].done;
            saveProject();
            updateProgress();
        }
        
        // Basculer un rang individuel
        function toggleRang(sectionIndex, stepIndex, rangNum) {
            const step = project.sections[sectionIndex].steps[stepIndex];
            const index = step.rangsDone.indexOf(rangNum);
            
            if (index > -1) {
                step.rangsDone.splice(index, 1);
            } else {
                step.rangsDone.push(rangNum);
            }
            
            // Marquer l'√©tape comme termin√©e si tous les rangs sont faits
            if (step.rangsDone.length === step.rangs) {
                step.done = true;
            } else {
                step.done = false;
            }
            
            saveProject();
            renderProject();
        }
        
        // Activer le mode √©dition pour une √©tape
        function editStep(sectionIndex, stepIndex) {
            // D√©sactiver toutes les autres √©ditions
            project.sections.forEach(section => {
                section.steps.forEach(step => {
                    step.editing = false;
                });
            });
            
            project.sections[sectionIndex].steps[stepIndex].editing = true;
            renderProject();
        }
        
        // Afficher/masquer les champs d'augmentation
        function toggleAugmentationFields(sectionIndex, stepIndex) {
            const checkbox = document.getElementById(`editAugmentation_${sectionIndex}_${stepIndex}`);
            const fields = document.getElementById(`augFields_${sectionIndex}_${stepIndex}`);
            fields.style.display = checkbox.checked ? 'block' : 'none';
        }
        
        // Sauvegarder les modifications d'une √©tape
        function saveStep(sectionIndex, stepIndex) {
            const step = project.sections[sectionIndex].steps[stepIndex];
            const oldRangs = step.rangs;
            
            step.name = document.getElementById(`editName_${sectionIndex}_${stepIndex}`).value;
            step.mailles = parseInt(document.getElementById(`editMailles_${sectionIndex}_${stepIndex}`).value);
            step.rangs = parseInt(document.getElementById(`editRangs_${sectionIndex}_${stepIndex}`).value);
            const newDetailRangs = document.getElementById(`editDetail_${sectionIndex}_${stepIndex}`).checked;
            
            // G√©rer les augmentations
            step.hasAugmentation = document.getElementById(`editAugmentation_${sectionIndex}_${stepIndex}`).checked;
            if (step.hasAugmentation) {
                step.augmentationMailles = parseInt(document.getElementById(`editAugMailles_${sectionIndex}_${stepIndex}`).value) || 2;
                step.augmentationFrequence = parseInt(document.getElementById(`editAugFrequence_${sectionIndex}_${stepIndex}`).value) || 8;
            }
            
            // Si on change le nombre de rangs et qu'on a le d√©tail activ√©
            if (newDetailRangs && step.rangs !== oldRangs) {
                // Filtrer les rangs coch√©s qui sont toujours valides
                step.rangsDone = step.rangsDone.filter(r => r <= step.rangs);
            }
            
            // Si on active le d√©tail pour la premi√®re fois
            if (newDetailRangs && !step.detailRangs) {
                step.rangsDone = [];
                step.done = false;
            }
            
            // Si on d√©sactive le d√©tail
            if (!newDetailRangs && step.detailRangs) {
                step.rangsDone = [];
            }
            
            step.detailRangs = newDetailRangs;
            step.editing = false;
            
            saveProject();
            renderProject();
        }
        
        // Annuler l'√©dition
        function cancelEdit(sectionIndex, stepIndex) {
            project.sections[sectionIndex].steps[stepIndex].editing = false;
            renderProject();
        }
        
        // Supprimer une √©tape
        function deleteStep(sectionIndex, stepIndex) {
            if (confirm('Voulez-vous vraiment supprimer cette √©tape ?')) {
                project.sections[sectionIndex].steps.splice(stepIndex, 1);
                saveProject();
                renderProject();
            }
        }
        
        // Ajouter une √©tape √† une section existante
        function addStepToSection(sectionIndex) {
            project.sections[sectionIndex].steps.push({
                name: "Nouvelle √©tape",
                mailles: 50,
                rangs: 60,
                done: false,
                detailRangs: false,
                rangsDone: []
            });
            saveProject();
            renderProject();
        }
        
        // Mettre √† jour la barre de progression
        function updateProgress() {
            let total = 0;
            let done = 0;
            
            project.sections.forEach(section => {
                section.steps.forEach(step => {
                    total++;
                    if (step.done) done++;
                });
            });
            
            const percentage = total > 0 ? Math.round((done / total) * 100) : 0;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
        }
        
        // Ajouter une section
        function addSection() {
            const name = document.getElementById('newSectionName').value.trim();
            if (!name) {
                alert('Veuillez entrer un nom pour la partie');
                return;
            }
            
            project.sections.push({
                name: name,
                steps: [
                    { name: "√âtape 1", mailles: 50, rangs: 60, done: false, detailRangs: false, rangsDone: [] }
                ]
            });
            
            document.getElementById('newSectionName').value = '';
            saveProject();
            renderProject();
        }
        
        // Supprimer une section
        function deleteSection(index) {
            if (confirm('Voulez-vous vraiment supprimer cette partie ?')) {
                project.sections.splice(index, 1);
                saveProject();
                renderProject();
            }
        }
        
        // Calculer la conversion
        function calculerConversion() {
            const modelMailles = parseFloat(document.getElementById('modelMailles').value);
            const modelRangs = parseFloat(document.getElementById('modelRangs').value);
            const realMailles = parseFloat(document.getElementById('realMailles').value);
            const realRangs = parseFloat(document.getElementById('realRangs').value);
            const maillesAConvertir = parseFloat(document.getElementById('maillesAConvertir').value);
            const rangsAConvertir = parseFloat(document.getElementById('rangsAConvertir').value);
            
            if (!modelMailles || !modelRangs || !realMailles || !realRangs) {
                alert('Veuillez remplir tous les champs d\'√©chantillon');
                return;
            }
            
            // Calcul des coefficients de conversion
            const coeffMailles = realMailles / modelMailles;
            const coeffRangs = realRangs / modelRangs;
            
            const maillesConverties = Math.round(maillesAConvertir * coeffMailles);
            const rangsConvertis = Math.round(rangsAConvertir * coeffRangs);
            
            const resultat = document.getElementById('resultatConversion');
            resultat.innerHTML = `
                <div class="result">
                    <h3>‚úÖ R√©sultat de la conversion</h3>
                    <div class="conversion-item">
                        <strong>Mailles :</strong> ${maillesAConvertir} ‚Üí <strong>${maillesConverties}</strong> mailles
                    </div>
                    <div class="conversion-item">
                        <strong>Rangs :</strong> ${rangsAConvertir} ‚Üí <strong>${rangsConvertis}</strong> rangs
                    </div>
                    <div class="conversion-item" style="margin-top: 10px; padding-top: 10px; border-top: 2px solid #4caf50;">
                        <strong>Coefficient mailles :</strong> ${coeffMailles.toFixed(3)}<br>
                        <strong>Coefficient rangs :</strong> ${coeffRangs.toFixed(3)}
                    </div>
                </div>
            `;
        }
        
        // Calculer les augmentations/diminutions
        function calculerAugmentation() {
            const modelMailles = parseFloat(document.getElementById('augModelMailles').value);
            const modelRangs = parseFloat(document.getElementById('augModelRangs').value);
            const realMailles = parseFloat(document.getElementById('augRealMailles').value);
            const realRangs = parseFloat(document.getElementById('augRealRangs').value);
            const frequenceRangs = parseFloat(document.getElementById('frequenceRangs').value);
            const totalRangs = parseFloat(document.getElementById('totalRangs').value);
            
            if (!modelMailles || !modelRangs || !realMailles || !realRangs || !frequenceRangs || !totalRangs) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            // Calcul du coefficient de conversion pour les rangs
            const coeffRangs = realRangs / modelRangs;
            
            // Conversion de la fr√©quence et du total
            const nouvelleFrequence = Math.round(frequenceRangs * coeffRangs);
            const nouveauTotal = Math.round(totalRangs * coeffRangs);
            
            // Calcul du nombre d'augmentations
            const nbAugmentationsModele = Math.floor(totalRangs / frequenceRangs);
            const nbAugmentationsReel = Math.floor(nouveauTotal / nouvelleFrequence);
            
            const resultat = document.getElementById('resultatAugmentation');
            resultat.innerHTML = `
                <div class="result">
                    <h3>‚úÖ Instructions converties</h3>
                    <div class="conversion-item" style="font-size: 16px; padding: 12px 0;">
                        <strong>Augmenter/diminuer d'1 maille tous les <span style="color: #667eea; font-size: 20px;">${nouvelleFrequence}</span> rangs</strong>
                    </div>
                    <div class="conversion-item" style="font-size: 16px; padding: 12px 0;">
                        <strong>Sur un total de <span style="color: #667eea; font-size: 20px;">${nouveauTotal}</span> rangs</strong>
                    </div>
                    <div class="conversion-item" style="margin-top: 10px; padding-top: 10px; border-top: 2px solid #4caf50;">
                        <strong>Mod√®le :</strong> ${nbAugmentationsModele} augmentations (1 tous les ${frequenceRangs} rangs)<br>
                        <strong>Votre tricot :</strong> ${nbAugmentationsReel} augmentations (1 tous les ${nouvelleFrequence} rangs)
                    </div>
                    <div class="conversion-item">
                        <strong>Coefficient rangs :</strong> ${coeffRangs.toFixed(3)}
                    </div>
                </div>
            `;
        }
        
        // Convertir CM vers Mailles/Rangs
        function calculerCmVersMailles() {
            const realMailles = parseFloat(document.getElementById('realMailles').value);
            const realRangs = parseFloat(document.getElementById('realRangs').value);
            const largeurCm = parseFloat(document.getElementById('largeurCm').value);
            const hauteurCm = parseFloat(document.getElementById('hauteurCm').value);
            
            if (!realMailles || !realRangs || !largeurCm || !hauteurCm) {
                alert('Veuillez remplir l\'√©chantillon ci-dessus et les dimensions en cm');
                return;
            }
            
            // Calcul : (mailles pour 10cm) * (largeur en cm) / 10
            const maillesCalculees = Math.round((realMailles * largeurCm) / 10);
            const rangsCalcules = Math.round((realRangs * hauteurCm) / 10);
            
            const resultat = document.getElementById('resultatCmVersMailles');
            resultat.innerHTML = `
                <div class="result" style="margin-top: 15px;">
                    <h3>‚úÖ Pour ${largeurCm} cm √ó ${hauteurCm} cm</h3>
                    <div class="conversion-item">
                        <strong>Largeur :</strong> ${largeurCm} cm = <strong>${maillesCalculees} mailles</strong>
                    </div>
                    <div class="conversion-item">
                        <strong>Hauteur :</strong> ${hauteurCm} cm = <strong>${rangsCalcules} rangs</strong>
                    </div>
                </div>
            `;
        }
        
        // Convertir Mailles/Rangs vers CM
        function calculerMaillesVersCm() {
            const realMailles = parseFloat(document.getElementById('realMailles').value);
            const realRangs = parseFloat(document.getElementById('realRangs').value);
            const mailles = parseFloat(document.getElementById('maillesVersCm').value);
            const rangs = parseFloat(document.getElementById('rangsVersCm').value);
            
            if (!realMailles || !realRangs || !mailles || !rangs) {
                alert('Veuillez remplir l\'√©chantillon ci-dessus et le nombre de mailles/rangs');
                return;
            }
            
            // Calcul : (nombre de mailles) * 10 / (mailles pour 10cm)
            const largeurCm = ((mailles * 10) / realMailles).toFixed(1);
            const hauteurCm = ((rangs * 10) / realRangs).toFixed(1);
            
            const resultat = document.getElementById('resultatMaillesVersCm');
            resultat.innerHTML = `
                <div class="result" style="margin-top: 15px;">
                    <h3>‚úÖ Pour ${mailles} mailles √ó ${rangs} rangs</h3>
                    <div class="conversion-item">
                        <strong>Largeur :</strong> ${mailles} mailles = <strong>${largeurCm} cm</strong>
                    </div>
                    <div class="conversion-item">
                        <strong>Hauteur :</strong> ${rangs} rangs = <strong>${hauteurCm} cm</strong>
                    </div>
                </div>
            `;
        }
        
        // Changer d'onglet
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // Initialiser au chargement
        loadProject();
    </script>
</body>
</html>
